---
permalink: maintain/restoring-object-data-to-storage-volume.html 
sidebar: sidebar 
keywords: restore replicated data, restore erasure-coded data, recover storage node, recover storage volume 
summary: Dopo aver ripristinato i volumi di archiviazione per un nodo di archiviazione non appliance, è possibile ripristinare i dati degli oggetti replicati o codificati per la cancellazione che sono andati persi a causa del guasto del nodo di archiviazione. 
---
= Ripristinare i dati dell'oggetto nel volume di archiviazione (errore dell'unità di sistema)
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Dopo aver ripristinato i volumi di archiviazione per un nodo di archiviazione non appliance, è possibile ripristinare i dati degli oggetti replicati o codificati per la cancellazione che sono andati persi a causa del guasto del nodo di archiviazione.



== Quale procedura dovrei usare?

Se possibile, ripristinare i dati dell'oggetto utilizzando la pagina *Ripristino volume* in Grid Manager.

* Se i volumi sono elencati in *MANUTENZIONE* > *Ripristino volume* > *Nodi da ripristinare*, ripristinare i dati dell'oggetto utilizzandolink:../maintain/restoring-volume.html["Pagina di ripristino del volume in Grid Manager"] .
* Se i volumi non sono elencati in *MANUTENZIONE* > *Ripristino volume* > *Nodi da ripristinare*, seguire i passaggi seguenti per utilizzare `repair-data` script per ripristinare i dati dell'oggetto.
+
Se il nodo di archiviazione recuperato contiene meno volumi rispetto al nodo che sta sostituendo, è necessario utilizzare `repair-data` sceneggiatura.




NOTE: Lo script repair-data è obsoleto e verrà rimosso in una versione futura.  Quando possibile, utilizzare illink:../maintain/restoring-volume.html["Procedura di ripristino del volume in Grid Manager"] .



== Utilizzare il `repair-data` script per ripristinare i dati dell'oggetto

.Prima di iniziare
* Hai confermato che il nodo di archiviazione recuperato ha uno stato di connessione *Connesso*image:../media/icon_alert_green_checkmark.png["icona avviso segno di spunta verde"] nella scheda *NODI* > *Panoramica* nel Grid Manager.


.Informazioni su questo compito
I dati degli oggetti possono essere ripristinati da altri nodi di archiviazione o da un pool di archiviazione cloud, presupponendo che le regole ILM della griglia siano state configurate in modo che siano disponibili copie degli oggetti.

Notare quanto segue:

* Se una regola ILM è stata configurata per archiviare solo una copia replicata e tale copia esisteva su un volume di archiviazione che ha generato un errore, non sarà possibile ripristinare l'oggetto.
* Se l'unica copia rimanente di un oggetto si trova in un Cloud Storage Pool, StorageGRID deve inviare più richieste all'endpoint del Cloud Storage Pool per ripristinare i dati dell'oggetto.  Prima di eseguire questa procedura, contattare l'assistenza tecnica per ottenere assistenza nella stima dei tempi di ripristino e dei costi associati.




== Informazioni su `repair-data` sceneggiatura

Per ripristinare i dati dell'oggetto, eseguire il comando `repair-data` sceneggiatura.  Questo script avvia il processo di ripristino dei dati dell'oggetto e funziona con la scansione ILM per garantire che le regole ILM vengano rispettate.

Seleziona *Dati replicati* o *Dati con codice di cancellazione (EC)* qui sotto per conoscere le diverse opzioni per `repair-data` script, a seconda che si stiano ripristinando dati replicati o dati con codice di cancellazione.  Se è necessario ripristinare entrambi i tipi di dati, è necessario eseguire entrambi i set di comandi.


NOTE: Per maggiori informazioni sul `repair-data` script, inserisci `repair-data --help` dalla riga di comando del nodo di amministrazione primario.


NOTE: Lo script repair-data è obsoleto e verrà rimosso in una versione futura.  Quando possibile, utilizzare illink:../maintain/restoring-volume.html["Procedura di ripristino del volume in Grid Manager"] .

[role="tabbed-block"]
====
.Dati replicati
--
Sono disponibili due comandi per ripristinare i dati replicati, a seconda che sia necessario riparare l'intero nodo o solo determinati volumi sul nodo:

`repair-data start-replicated-node-repair`

`repair-data start-replicated-volume-repair`

È possibile monitorare le riparazioni dei dati replicati con questo comando:

`repair-data show-replicated-repair-status`

--
.Dati con codice di cancellazione (EC)
--
Sono disponibili due comandi per ripristinare i dati codificati in modo da essere cancellati, a seconda che sia necessario riparare l'intero nodo o solo determinati volumi sul nodo:

`repair-data start-ec-node-repair`

`repair-data start-ec-volume-repair`

È possibile monitorare le riparazioni dei dati codificati in modo da cancellarli con questo comando:

`repair-data show-ec-repair-status`


NOTE: Le riparazioni dei dati codificati in modo da essere cancellati possono iniziare mentre alcuni nodi di archiviazione sono offline.  Tuttavia, se non è possibile recuperare tutti i dati codificati in modo da cancellarli, la riparazione non può essere completata.  La riparazione verrà completata quando tutti i nodi saranno disponibili.


NOTE: Il lavoro di riparazione EC riserva temporaneamente una grande quantità di spazio di archiviazione.  Potrebbero essere attivati avvisi di archiviazione, ma il problema si risolverà al termine della riparazione.  Se non c'è abbastanza spazio per la prenotazione, il lavoro di riparazione EC fallirà.  Le prenotazioni di archiviazione vengono rilasciate al termine del processo di riparazione EC, indipendentemente dal fatto che il processo sia fallito o riuscito.

--
====


== Trova il nome host per il nodo di archiviazione

. Accedi al nodo di amministrazione principale:
+
.. Immettere il seguente comando: `ssh admin@_primary_Admin_Node_IP_`
.. Inserisci la password elencata nel `Passwords.txt` file.
.. Immettere il seguente comando per passare alla root: `su -`
.. Inserisci la password elencata nel `Passwords.txt` file.
+
Quando si accede come root, il prompt cambia da `$` A `#` .



. Utilizzare il `/etc/hosts` file per trovare il nome host del nodo di archiviazione per i volumi di archiviazione ripristinati.  Per visualizzare un elenco di tutti i nodi nella griglia, immettere quanto segue: `cat /etc/hosts` .




== Ripara i dati se tutti i volumi sono falliti

Se tutti i volumi di archiviazione sono guasti, riparare l'intero nodo.  Seguire le istruzioni per i *dati replicati*, i *dati con codice di cancellazione (EC)* o entrambi, a seconda che si utilizzino dati replicati, dati con codice di cancellazione (EC) o entrambi.

Se solo alcuni volumi sono falliti, vai a<<Riparare i dati se solo alcuni volumi sono falliti>> .


NOTE: Non puoi correre `repair-data` operazioni per più di un nodo contemporaneamente.  Per recuperare più nodi, contattare l'assistenza tecnica.

[role="tabbed-block"]
====
.Dati replicati
--
Se la griglia include dati replicati, utilizzare `repair-data start-replicated-node-repair` comando con il `--nodes` opzione, dove `--nodes` è il nome host (nome del sistema) per riparare l'intero nodo di archiviazione.

Questo comando ripara i dati replicati su un nodo di archiviazione denominato SG-DC-SN3:

`repair-data start-replicated-node-repair --nodes SG-DC-SN3`


NOTE: Quando i dati degli oggetti vengono ripristinati, viene attivato l'avviso *Oggetti persi* se il sistema StorageGRID non riesce a individuare i dati degli oggetti replicati. Gli avvisi potrebbero essere attivati ​​sui nodi di archiviazione in tutto il sistema. Dovresti determinare la causa della perdita e se è possibile un recupero. Vedere link:../troubleshoot/investigating-lost-objects.html["Indagare sugli oggetti smarriti"] .

--
.Dati con codice di cancellazione (EC)
--
Se la griglia contiene dati con codice di cancellazione, utilizzare `repair-data start-ec-node-repair` comando con il `--nodes` opzione, dove `--nodes` è il nome host (nome del sistema) per riparare l'intero nodo di archiviazione.

Questo comando ripara i dati codificati in modo da essere cancellati su un nodo di archiviazione denominato SG-DC-SN3:

`repair-data start-ec-node-repair --nodes SG-DC-SN3`

L'operazione restituisce un valore univoco `repair ID` che identifica questo `repair_data` operazione.  Usa questo `repair ID` per monitorare i progressi e i risultati del `repair_data` operazione.  Non verrà restituito alcun altro feedback una volta completato il processo di recupero.

Le riparazioni dei dati codificati in modo da essere cancellati possono iniziare mentre alcuni nodi di archiviazione sono offline.  La riparazione verrà completata quando tutti i nodi saranno disponibili.

--
====


== Riparare i dati se solo alcuni volumi sono falliti

Se solo alcuni volumi sono guasti, riparare i volumi interessati.  Seguire le istruzioni per i *dati replicati*, i *dati con codice di cancellazione (EC)* o entrambi, a seconda che si utilizzino dati replicati, dati con codice di cancellazione (EC) o entrambi.

Se tutti i volumi sono falliti, vai a<<Ripara i dati se tutti i volumi sono falliti>> .

Immettere gli ID del volume in formato esadecimale.  Per esempio, `0000` è il primo volume e `000F` è il sedicesimo volume.  È possibile specificare un volume, un intervallo di volumi o più volumi non in sequenza.

Tutti i volumi devono trovarsi sullo stesso nodo di archiviazione.  Se è necessario ripristinare volumi per più di un nodo di archiviazione, contattare l'assistenza tecnica.

[role="tabbed-block"]
====
.Dati replicati
--
Se la griglia contiene dati replicati, utilizzare `start-replicated-volume-repair` comando con il `--nodes` opzione per identificare il nodo (dove `--nodes` è il nome host del nodo).  Quindi aggiungere o il `--volumes` O `--volume-range` opzione, come mostrato negli esempi seguenti.

*Volume singolo*: questo comando ripristina i dati replicati nel volume `0002` su un nodo di archiviazione denominato SG-DC-SN3:

`repair-data start-replicated-volume-repair --nodes SG-DC-SN3 --volumes 0002`

*Intervallo di volumi*: questo comando ripristina i dati replicati su tutti i volumi nell'intervallo `0003` A `0009` su un nodo di archiviazione denominato SG-DC-SN3:

`repair-data start-replicated-volume-repair --nodes SG-DC-SN3 --volume-range 0003,0009`

*Volumi multipli non in sequenza*: questo comando ripristina i dati replicati nei volumi `0001` , `0005` , E `0008` su un nodo di archiviazione denominato SG-DC-SN3:

`repair-data start-replicated-volume-repair --nodes SG-DC-SN3 --volumes 0001,0005,0008`


NOTE: Quando i dati degli oggetti vengono ripristinati, viene attivato l'avviso *Oggetti persi* se il sistema StorageGRID non riesce a individuare i dati degli oggetti replicati. Gli avvisi potrebbero essere attivati ​​sui nodi di archiviazione in tutto il sistema. Prendere nota della descrizione dell'avviso e delle azioni consigliate per determinare la causa della perdita e se è possibile un recupero.

--
.Dati con codice di cancellazione (EC)
--
Se la griglia contiene dati con codice di cancellazione, utilizzare `start-ec-volume-repair` comando con il `--nodes` opzione per identificare il nodo (dove `--nodes` è il nome host del nodo).  Quindi aggiungere o il `--volumes` O `--volume-range` opzione, come mostrato negli esempi seguenti.

*Volume singolo*: questo comando ripristina i dati codificati in cancellazione nel volume `0007` su un nodo di archiviazione denominato SG-DC-SN3:

`repair-data start-ec-volume-repair --nodes SG-DC-SN3 --volumes 0007`

*Intervallo di volumi*: questo comando ripristina i dati codificati in cancellazione su tutti i volumi nell'intervallo `0004` A `0006` su un nodo di archiviazione denominato SG-DC-SN3:

`repair-data start-ec-volume-repair --nodes SG-DC-SN3 --volume-range 0004,0006`

*Volumi multipli non in sequenza*: questo comando ripristina i dati codificati in cancellazione nei volumi `000A` , `000C` , E `000E` su un nodo di archiviazione denominato SG-DC-SN3:

`repair-data start-ec-volume-repair --nodes SG-DC-SN3 --volumes 000A,000C,000E`

IL `repair-data` l'operazione restituisce un valore univoco `repair ID` che identifica questo `repair_data` operazione.  Usa questo `repair ID` per monitorare i progressi e i risultati del `repair_data` operazione.  Non verrà restituito alcun altro feedback una volta completato il processo di recupero.


NOTE: Le riparazioni dei dati codificati in modo da essere cancellati possono iniziare mentre alcuni nodi di archiviazione sono offline.  La riparazione verrà completata quando tutti i nodi saranno disponibili.

--
====


== Riparazioni del monitor

Monitorare lo stato dei lavori di riparazione, a seconda che si utilizzino *dati replicati*, *dati con codice di cancellazione (EC)* o entrambi.

È inoltre possibile monitorare lo stato dei lavori di ripristino del volume in corso e visualizzare una cronologia dei lavori di ripristino completati inlink:../maintain/restoring-volume.html["Responsabile della griglia"] .

[role="tabbed-block"]
====
.Dati replicati
--
* Per ottenere una percentuale stimata di completamento per la riparazione replicata, aggiungere `show-replicated-repair-status` opzione al comando repair-data.
+
`repair-data show-replicated-repair-status`

* Per determinare se le riparazioni sono state completate:
+
.. Selezionare *NODI* > *_Nodo di archiviazione in riparazione_* > *ILM*.
.. Esaminare gli attributi nella sezione Valutazione.  Una volta completate le riparazioni, l'attributo *In attesa - Tutto* indica 0 oggetti.


* Per monitorare la riparazione in modo più dettagliato:
+
.. Selezionare *SUPPORTO* > *Strumenti* > *Topologia griglia*.
.. Selezionare *_grid_* > *_Nodo di archiviazione in riparazione_* > *LDR* > *Data Store*.
.. Utilizzare una combinazione dei seguenti attributi per determinare, nel miglior modo possibile, se le riparazioni replicate sono complete.
+

NOTE: Potrebbero essere presenti incongruenze in Cassandra e le riparazioni non riuscite non vengono tracciate.

+
*** *Riparazioni tentate (XRPA)*: utilizzare questo attributo per monitorare l'avanzamento delle riparazioni replicate.  Questo attributo aumenta ogni volta che un nodo di archiviazione tenta di riparare un oggetto ad alto rischio.  Quando questo attributo non aumenta per un periodo più lungo del periodo di scansione corrente (fornito dall'attributo *Periodo di scansione - Stimato*), significa che la scansione ILM non ha trovato oggetti ad alto rischio che necessitano di riparazione su alcun nodo.
+

NOTE: Gli oggetti ad alto rischio sono oggetti che rischiano di andare completamente persi.  Sono esclusi gli oggetti che non soddisfano la loro configurazione ILM.

*** *Periodo di scansione - Stimato (XSCM)*: utilizzare questo attributo per stimare quando una modifica della policy verrà applicata agli oggetti precedentemente acquisiti.  Se l'attributo *Riparazioni tentate* non aumenta per un periodo più lungo del periodo di scansione corrente, è probabile che siano state eseguite riparazioni replicate.  Si noti che il periodo di scansione può variare.  L'attributo *Periodo di scansione - Stimato (XSCM)* si applica all'intera griglia ed è il massimo di tutti i periodi di scansione dei nodi.  È possibile interrogare la cronologia degli attributi *Periodo di scansione - Stima* per la griglia per determinare un intervallo di tempo appropriato.






--
.Dati con codice di cancellazione (EC)
--
Per monitorare la riparazione dei dati codificati in modo da cancellarli e riprovare eventuali richieste non riuscite:

. Determinare lo stato delle riparazioni dei dati codificati tramite cancellazione:
+
** Selezionare *SUPPORTO* > *Strumenti* > *Metriche* per visualizzare il tempo stimato per il completamento e la percentuale di completamento per il lavoro corrente. Quindi, seleziona *Panoramica EC* nella sezione Grafana. Consulta i dashboard *Tempo stimato per il completamento del lavoro EC in griglia* e *Percentuale completata del lavoro EC in griglia*.
** Utilizzare questo comando per visualizzare lo stato di uno specifico `repair-data` operazione:
+
`repair-data show-ec-repair-status --repair-id repair ID`

** Utilizzare questo comando per elencare tutte le riparazioni:
+
`repair-data show-ec-repair-status`

+
L'output elenca le informazioni, tra cui `repair ID` , per tutte le riparazioni eseguite in precedenza e attualmente.



. Se l'output mostra che l'operazione di riparazione non è riuscita, utilizzare `--repair-id` opzione per riprovare la riparazione.
+
Questo comando riprova una riparazione del nodo non riuscita, utilizzando l'ID di riparazione 6949309319275667690:

+
`repair-data start-ec-node-repair --repair-id 6949309319275667690`

+
Questo comando riprova una riparazione del volume non riuscita, utilizzando l'ID di riparazione 6949309319275667690:

+
`repair-data start-ec-volume-repair --repair-id 6949309319275667690`



--
====