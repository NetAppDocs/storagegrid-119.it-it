---
permalink: ilm/example-4-ilm-rules-and-policy-for-s3-versioned-objects.html 
sidebar: sidebar 
keywords: object versions, example ILM rule, information lifecycle rule examples 
summary: 'Se si dispone di un bucket S3 con il controllo delle versioni abilitato, è possibile gestire le versioni degli oggetti non correnti includendo regole nella policy ILM che utilizzano l"ora non corrente come ora di riferimento.' 
---
= Esempio 4: regole e policy ILM per oggetti con versione S3
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Se disponi di un bucket S3 con il controllo delle versioni abilitato, puoi gestire le versioni degli oggetti non correnti includendo regole nella policy ILM che utilizzano "Tempo non corrente" come tempo di riferimento.


CAUTION: Se si specifica un periodo di conservazione limitato per gli oggetti, tali oggetti verranno eliminati definitivamente una volta raggiunto il periodo di tempo specificato.  Assicuratevi di aver capito per quanto tempo gli oggetti verranno conservati.

Come mostra questo esempio, è possibile controllare la quantità di spazio di archiviazione utilizzato dagli oggetti sottoposti a controllo di versione utilizzando diverse istruzioni di posizionamento per le versioni non correnti degli oggetti.


CAUTION: Le seguenti regole e policy ILM sono solo esempi.  Esistono molti modi per configurare le regole ILM.  Prima di attivare una nuova policy, simulala per verificare che funzioni come previsto per proteggere i contenuti dalla perdita.


NOTE: Per eseguire la simulazione dei criteri ILM su una versione non corrente di un oggetto, è necessario conoscere l'UUID o il CBID della versione dell'oggetto.  Per trovare l'UUID e il CBID, utilizzarelink:verifying-ilm-policy-with-object-metadata-lookup.html["ricerca metadati oggetto"] mentre l'oggetto è ancora attuale.

.Informazioni correlate
link:how-objects-are-deleted.html["Come vengono eliminati gli oggetti"]



== Regola ILM 1 per esempio 4: Conservare tre copie per 10 anni

Questa regola ILM di esempio memorizza una copia di ciascun oggetto in tre siti per 10 anni.

Questa regola si applica a tutti gli oggetti, indipendentemente dal fatto che siano sottoposti a controllo di versione o meno.

[cols="1a,2a"]
|===
| Definizione della regola | Valore di esempio 


 a| 
Pool di stoccaggio
 a| 
Tre pool di archiviazione, ciascuno composto da data center diversi, denominati Sito 1, Sito 2 e Sito 3.



 a| 
Nome della regola
 a| 
Tre copie dieci anni



 a| 
Tempo di riferimento
 a| 
Tempo di ingestione



 a| 
Posizionamenti
 a| 
Il giorno 0, conservare tre copie replicate per 10 anni (3.652 giorni), una nel sito 1, una nel sito 2 e una nel sito 3.  Dopo 10 anni, eliminare tutte le copie dell'oggetto.

|===


== Regola ILM 2 per esempio 4: Salvare due copie delle versioni non correnti per 2 anni

Questa regola ILM di esempio memorizza due copie delle versioni non correnti di un oggetto con versione S3 per 2 anni.

Poiché la regola ILM 1 si applica a tutte le versioni dell'oggetto, è necessario creare un'altra regola per filtrare tutte le versioni non correnti.

Per creare una regola che utilizzi "Tempo non corrente" come orario di riferimento, seleziona *Sì* alla domanda "Applicare questa regola solo alle versioni precedenti degli oggetti (in bucket S3 con controllo delle versioni abilitato)?" nel passaggio 1 (Immetti dettagli) della procedura guidata Crea una regola ILM.  Selezionando *Sì*, _Tempo non corrente_ viene automaticamente selezionato come orario di riferimento e non è possibile selezionare un orario di riferimento diverso.

image::../media/ilm-rule-apply-only-to-older-object-verions.png[Applica la regola ILM solo alle versioni precedenti degli oggetti (tempo non corrente)]

In questo esempio, vengono archiviate solo due copie delle versioni non correnti, che verranno conservate per due anni.

[cols="1a,2a"]
|===
| Definizione della regola | Valore di esempio 


 a| 
Pool di archiviazione
 a| 
Due pool di archiviazione, ciascuno in data center diversi, Sito 1 e Sito 2.



 a| 
Nome della regola
 a| 
Versioni non correnti: due copie due anni



 a| 
Tempo di riferimento
 a| 
Tempo non corrente

Selezionato automaticamente quando si seleziona *Sì* alla domanda "Applicare questa regola solo alle versioni precedenti degli oggetti (in bucket S3 con controllo delle versioni abilitato)?" nella procedura guidata Crea una regola ILM.



 a| 
Posizionamenti
 a| 
Il giorno 0 relativo al tempo non corrente (ovvero a partire dal giorno in cui la versione dell'oggetto diventa la versione non corrente), conservare due copie replicate delle versioni dell'oggetto non corrente per 2 anni (730 giorni), una nel sito 1 e una nel sito 2.  Dopo 2 anni, eliminare le versioni non correnti.

|===


== Criterio ILM per esempio 4: oggetti con versione S3

Se si desidera gestire le versioni precedenti di un oggetto in modo diverso rispetto alla versione corrente, le regole che utilizzano "Tempo non corrente" come orario di riferimento devono comparire nel criterio ILM prima delle regole che si applicano alla versione corrente dell'oggetto.

Una policy ILM per oggetti con versione S3 potrebbe includere regole ILM come le seguenti:

* Conservare tutte le versioni precedenti (non aggiornate) di ciascun oggetto per 2 anni, a partire dal giorno in cui la versione è diventata non aggiornata.
+

NOTE: Le regole "Tempo non corrente" devono comparire nel criterio prima delle regole che si applicano alla versione corrente dell'oggetto.  In caso contrario, le versioni degli oggetti non correnti non verranno mai abbinate dalla regola "Tempo non corrente".

* Al momento dell'ingestione, creare tre copie replicate e conservarne una copia in ciascuno dei tre siti.  Conservare copie della versione corrente dell'oggetto per 10 anni.


Quando si simula la policy di esempio, ci si aspetterebbe che gli oggetti di prova vengano valutati come segue:

* Tutte le versioni non correnti degli oggetti verrebbero confrontate con la prima regola.  Se una versione non corrente di un oggetto è più vecchia di 2 anni, ILM la elimina definitivamente (tutte le copie della versione non corrente vengono rimosse dalla griglia).
* La versione corrente dell'oggetto verrebbe abbinata alla seconda regola.  Quando la versione corrente dell'oggetto è stata archiviata per 10 anni, il processo ILM aggiunge un marcatore di eliminazione come versione corrente dell'oggetto e rende la versione precedente dell'oggetto "non corrente".  La prossima volta che si verifica la valutazione ILM, questa versione non corrente viene abbinata alla prima regola.  Di conseguenza, la copia nel Sito 3 viene eliminata e le due copie nel Sito 1 e nel Sito 2 vengono conservate per altri 2 anni.

